<!DOCTYPE html>
<html lang='fr'>
<head>
	<title>FEpdf - Fusion</title>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="css/MainWin.css">
	<script type="text/javascript" src="js/Main.js"></script>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

</head>
<body>
	<div class="navbar navbar-default navbar-static-top">
		<div class="container">
			<div class="row text-center">
				<div class="navbar-brand">				
				<img src="logo.svg" alt="logo" width="50" height="50	"/>
				</div>					
				<div class="navbar-navbar" ><h2>Fusion</h2></div>
			</div>
		</div>
	</div>
	</div>
	<div class="container col-sm-10 col-sm-offset-1">
		<div class="row well">				





			<div class="col-sm-6 text-center" >
				 <div>
				 <div class="row text-right">
					<button type="button" class="btn btn-md btn-default" style="margin:2.5%" onclick="addNewFile(); addListenerTiret(NBFILE);"><i class="glyphicon glyphicon-plus"></i></button>
				 </div>
				
				<div style=" overflow-y:scroll;height:400px; " >
				
				<div class="col-sm-12" id="zone_nbFile">

					<div class="text-left"><b>Importer un fichier : </b></div>


					<div class="upload-drop-zone" id='drop-zone'>
						<b id="zoneDropText">Glisser-Déposer un PDF.</b>
					</div>
					<script type="text/javascript">

                        var NBFILE = 0;

                        var dropZone = document.getElementById('drop-zone');


                        //Fonction permettant d'ajouter plusieurs listener d'un coup
                        function addListenerMulti(el, s, fn) {
                            var evts = s.split(' ');
                            for (var i=0, iLen=evts.length; i<iLen; i++) {
                                el.addEventListener(evts[i], fn, false);
                            }
                        }
                        //Permet d'empecher le navigateur d'ouvrir les fichiers à sa facons
                        addListenerMulti(window,'drag dragend dragover dragenter dragleave drop', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                        });


                        dropZone.addEventListener('dragover', function(e) {
                            e.stopPropagation();
                            e.preventDefault();
                            dropZone.className = "upload-drop-zone dragover";

                        });

                        dropZone.addEventListener('dragleave', function(e) {
                            dropZone.className="upload-drop-zone";
                        });



                        dropZone.addEventListener('drop', function(e) {
                            e.stopPropagation();
                            e.preventDefault();
                            dropZone.className="upload-drop-zone";
                            $('#zoneDropText').replaceWith('<b id="zoneDropText">Just kidding drag and drop isn\'t supported.</b>');

                            // Récupération des données :
                            var dt    = e.dataTransfer;
                            var files = dt.files;
                            for (var i=0; i<files.length; i++) {
                                var file = files[i];
                                var reader = new FileReader();
                                var name = file.name;
                                //attach event handlers here :
                                reader.addEventListener('loadend', function(e, file) {
                                    var bin           = this.result;
                                    var pdf=document.createElement('object');
                                    pdf.type="application/pdf";
                                    pdf.data=bin;
                                    pdf.width="100%";
                                    pdf.height="600";
									pdf.id="pdf";
                                    var oldpdf=document.getElementById('pdf');
                                    if(oldpdf!=null) {
                                        document.getElementById('zone-pdf').removeChild(oldpdf);
                                    }
                                    document.getElementById('zone-pdf').appendChild(pdf);
                                    addNewFile();
                                    addListenerTiret(NBFILE);
                                    document.getElementById('inputPath'+NBFILE).value=name;

                                });
								alert(name);
                                reader.readAsDataURL(file);
                            }

                            return false;
						});


                        function searchinput(nbfile) {
                            var input=document.getElementById("fileInput"+nbfile);
                            input.click();
                            input.onchange=function() {
                                var path = document.getElementById('fileInput'+nbfile).value;

                                var file=input.files[0];
								var name=file.name;
                                if(name.substring(name.length-4,name.length) != ".pdf") {
                                    alert("Vous ne pouvez ajouter que des fichiers PDF.")
                                    return;
                                }
                                document.getElementById('inputPath'+nbfile).value=name;

                                var reader = new FileReader();

                                //attach event handlers here :
                                reader.addEventListener('loadend', function(e, file) {
                                    var bin           = this.result;
                                    var pdf=document.createElement('object');
                                    pdf.type="application/pdf";
                                    pdf.data=bin;
                                    pdf.width="100%";
                                    pdf.height="600";
                                    pdf.id="pdf";
                                    var oldpdf=document.getElementById('pdf');
                                    if(oldpdf!=null) {
                                        document.getElementById('zone-pdf').removeChild(oldpdf);
                                    }
                                    document.getElementById('zone-pdf').appendChild(pdf);

                                });

                                reader.readAsDataURL(file);


                            }
                        }

                        function searchoutput() {
                            document.getElementById('fileOutput').click();
                            document.getElementById('fileOutput').onchange=function() {
                                var repertory = document.getElementById('fileOutput').files[0];
                                document.getElementById('outputPath').value=repertory.name;
                            }
                        }
					</script>

					<div class="text-left"><b>Ou parcourez vos fichiers:</b></div>
					<div class="text-left" id="zoneMobile0">
						<p style="margin : 0 0 0 20px;">Selectionner un PDF à fusionner</p>

				 <form>
					 <i class="glyphicon glyphicon-trash movebtn" id="trash0" onclick="trashFILE(0)"></i>
					 <i class="glyphicon glyphicon-move movebtn" id="tiretMove0" ></i>
				  <div class="input-group" style="margin-bottom:2.5%;">

				    <input type="text" class="form-control" placeholder="Chemin vers fichier" id="inputPath0" disabled style="cursor: text">
				    <div class="input-group-btn">

						<input id="fileInput0" accept="application/pdf" type="file" style="display:none;" />
						<input type="button" class="btn btn-default"  value="Parcourir" onclick="searchinput(0);"/>

				    </div>
				  </div>
				</form>
				</div>

					<script type="text/javascript">

                        function addListenerTiret(tiretid){
                            document.getElementById('tiretMove'+tiretid).addEventListener('dragstart', function (e) {
                                //var dt =e.dataTransfer;
                                e.dataTransfer.setDragImage(document.getElementById('zoneMobile'+tiretid),10,40);

                            });
                        }

                        addListenerTiret(0);


					</script>

				<div id="zoneDrag&Drop">

				</div>



				</div>
				</div>				


				</div>
				<hr>
				<div class="text-left">
				Enregistrer dans le repertoire:
				 <form>
				  <div class="input-group" style="margin-bottom:2.5%;">
				    <input type="text" class="form-control" placeholder="Chemin vers fichier" id="outputPath" disabled>

					  <div class="input-group-btn">
						  <input id="fileOutput" accept="application/pdf" type="file" style="display:none;" />
						  <input type="button" class="btn btn-default"  value="Parcourir" onclick="searchoutput(0)"/>
					  </div>

				  </div>
				</form>
				</div>
				<div></div>
				<div class="row progress">
  					<div class="progress-bar" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width:70%">
   				 	<span class="sr-only">70% Complete</span>
  				</div>
				</div>
				<div class="row">
				<button type="button" class="btn btn-lg btn-primary " style="margin-left:10%;margin-right:10%;">Annuler</button>
				<button type="button" class="btn btn-lg btn-primary " style="margin-left:10%;margin-right:10%;" onclick="alertSave()">Valider</button>
				</div>
							
			</div> 

			<div class="col-sm-6 visible-md visible-lg" style="text-align:center;">
				
				<div class="row text-right">
					<button type="button" class="btn btn-md btn-primary" style="margin:1%;"><i class="glyphicon glyphicon glyphicon-refresh"></i></button>
				</div>				

				<div class="row view-pdf" id="zone-pdf">
						<!--<object type="application/pdf" data="git_real_slides.pdf" width="100%" height="600" id="pdf">No Support</object>-->
				</div>


				<div class="row">
				<button type="button" class="btn btn-md btn-primary " style="margin-left:5%;margin-right:5%;" onclick="prevPage()"><i class="glyphicon glyphicon glyphicon-arrow-left"></i></button>
				<button type="button" class="btn btn-md btn-primary " style="margin-left:5%;margin-right:5%;">Selectionner</button>
				<button type="button" class="btn btn-md btn-primary " style="margin-left:5%;margin-right:5%;" onclick="nextPage()"><i class="glyphicon glyphicon glyphicon-arrow-right"></i></button>
				</div>
			</div> 				
		</div>
	</div> 
	<div class="container-fluid">
	</div> 
	<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js' type="text/	javascript"></script>
	<script src='js/bootstrap.js'></script>
	 <footer>
		Maxime CHAREYRON - Nahel CHAZOT - Alexandre DONNE - Jérome MASSARD - Ivan SCHMIDT
  	</footer>
</body>
</html>
